--- 
title: "Patrick's Auto Shop Productivity Report"
subtitle: "Where Should You Spend Your Time for Maximum Productivity"
format:
  html: default
execute:
  echo: true
  eval: true
---

```{python}
#| include: false
#| echo: false
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Set style
plt.style.use('seaborn-v0_8-whitegrid')
sns.set_palette("husl")

# Load data
carsDF = pd.read_csv("carsFixed.csv")

# Create descriptive labels
carsDF['Shop'] = 'Shop ' + carsDF['shopID'].astype(str)
carsDF['Boss Present'] = carsDF['boss'].map({0: 'You Away', 1: 'You Present'})

# Add day of week (assuming observations are consecutive days, starting from Monday)
carsDF['DayOfWeek'] = (carsDF['observation'] - 1) % 7
days_map = {0: 'Monday', 1: 'Tuesday', 2: 'Wednesday', 3: 'Thursday', 4: 'Friday', 5: 'Saturday', 6: 'Sunday'}
carsDF['DayName'] = carsDF['DayOfWeek'].map(days_map)
carsDF['DayOrder'] = carsDF['DayOfWeek'].map({0: 1, 1: 2, 2: 3, 3: 4, 4: 5, 5: 6, 6: 7})

# Add week number and year projection
carsDF['WeekNumber'] = ((carsDF['observation'] - 1) // 7) + 1
carsDF['Year'] = ((carsDF['observation'] - 1) // 365) + 1
carsDF['DayOfYear'] = ((carsDF['observation'] - 1) % 365) + 1

# Calculate summary stats
summary = carsDF.groupby(['shopID', 'boss'])['carsFixed'].agg(['mean', 'std', 'count']).reset_index()
summary_pivot = summary.pivot(index='shopID', columns='boss', values='mean')
summary_pivot.columns = ['Boss Away', 'Boss Present']
summary_pivot['Boost'] = summary_pivot['Boss Present'] - summary_pivot['Boss Away']

# Calculate confidence intervals (95%)
def calc_ci(group):
    n = len(group)
    mean = group.mean()
    std = group.std()
    se = std / np.sqrt(n)
    ci = 1.96 * se
    return pd.Series({'mean': mean, 'ci': ci, 'n': n})

boss_stats = carsDF.groupby(['shopID', 'boss'])['carsFixed'].apply(calc_ci).unstack()

# Define shop IDs
shop_ids = [1, 2, 3, 4, 5]
```

## The Bottom Line ðŸŽ¯

**Patrick, here's what your data tells us:** Your presence at the shop matters most at **Shop 4** and **Shop 1**. When you're there, these shops fix significantly more cars. Some other shops? They do just fine without you.


**Our recommendation:** Patrick should prioritize Shop 4 and Shop 1. He should visit Shop 4 and Shop 1 for half of the year. He should visit the other shops for the other half of the year.

---

## What the Data Shows

We analyzed 250 days of productivity data across your 5 shops. Here's every single day plottedâ€”you can see the pattern clearly:

```{python}
#| fig-cap: "Style 1: Scatter Plot with Jitter - Each dot is one day. Green = you were there. Orange = you were away."
#| fig-width: 11
#| fig-height: 10
#| echo: false

fig, ax = plt.subplots(figsize=(11, 10))

np.random.seed(42)
jitter = 0.15

colors = {'You Away': '#E67E22', 'You Present': '#27AE60'}

# Stack all shops in one column
for i, shop in enumerate(range(1, 6)):
    shop_data = carsDF[carsDF['shopID'] == shop]
    
    # Plot points for each boss presence status, stacked vertically by shop
    for j, (boss_label, color) in enumerate(colors.items()):
        mask = shop_data['Boss Present'] == boss_label
        data = shop_data[mask]
        x = np.zeros(len(data)) + i + np.random.uniform(-jitter, jitter, len(data))
        ax.scatter(x, data['carsFixed'], alpha=0.6, s=50, c=color, 
                   edgecolors='white', linewidth=0.5)
    
    # Calculate and show means
    away_mean = shop_data[shop_data['boss'] == 0]['carsFixed'].mean()
    present_mean = shop_data[shop_data['boss'] == 1]['carsFixed'].mean()
    delta = present_mean - away_mean
    
    # Draw mean lines
    ax.hlines(away_mean, i - 0.3, i + 0.3, colors='#E67E22', linewidth=3, linestyle='-')
    ax.hlines(present_mean, i - 0.3, i + 0.3, colors='#27AE60', linewidth=3, linestyle='-')
    
    # Add delta label above the data
    delta_color = '#27AE60' if delta > 0 else '#E74C3C'
    delta_label = f'+{delta:.1f}' if delta > 0 else f'{delta:.1f}'
    ax.text(i, 72, f'Î” {delta_label}', ha='center', va='center', fontsize=10, 
            fontweight='bold', color='white',
            bbox=dict(boxstyle='round,pad=0.3', facecolor=delta_color, edgecolor='none', alpha=0.9))
    
    # Get sample sizes
    n_away = len(shop_data[shop_data['boss'] == 0])
    n_present = len(shop_data[shop_data['boss'] == 1])
    ax.text(i, -5, f'n={n_away+n_present}', ha='center', fontsize=9, style='italic')

# Set up axes
ax.set_xticks(range(5))
ax.set_xticklabels([f'Shop {i}' for i in range(1, 6)], fontsize=11, fontweight='bold')
ax.set_ylabel('Cars Fixed (Daily Productivity)', fontweight='bold', fontsize=12)
ax.set_ylim(-10, 90)
ax.set_xlim(-0.6, 4.6)

# Add legend
from matplotlib.patches import Patch
legend_elements = [Patch(facecolor='#E67E22', label='You Away'),
                   Patch(facecolor='#27AE60', label='You Present')]
ax.legend(handles=legend_elements, loc='upper right', fontsize=11, title='Your Presence', 
          title_fontsize=12, frameon=True)

ax.set_title('Style 1: Scatter Plot - Daily Productivity by Shop', fontsize=14, fontweight='bold')
plt.tight_layout()
plt.show()
```
***What the data shows:*** All shops are stacked in one view, with each column showing one shopâ€™s daily productivity. Green dots = you were there, orange dots = you were away. The horizontal lines show the mean for each condition. The delta (Î”) shows how many more cars get fixed when youâ€™re there. Shop 4 has the biggest delta (+12.8), while Shop 3 (your brotherâ€™s shop) shows the smallest improvement (+2.9)

***Distribution Comparison: Bar Chart*** This view shows the average productivity for each shop when youâ€™re away vs. when youâ€™re present. Bars = average productivity. The delta (Î”) shows how many more cars get fixed when youâ€™re present. Shop 4 has the biggest delta (+12.8), while Shop 3 (your brotherâ€™s shop) shows the smallest improvement (+2.9)

```{python}
#| fig-cap: "Style 2: Grouped Bar Chart - Comparing average productivity side by side"
#| fig-width: 10
#| fig-height: 7
#| echo: false

fig, ax = plt.subplots(figsize=(8, 5))   

x = np.arange(len(shop_ids))
width = 0.35

means_away = [carsDF[(carsDF['shopID'] == shop) & (carsDF['boss'] == 0)]['carsFixed'].mean() for shop in shop_ids]
means_present = [carsDF[(carsDF['shopID'] == shop) & (carsDF['boss'] == 1)]['carsFixed'].mean() for shop in shop_ids]

# Create bars
bars1 = ax.bar(x - width/2, means_away, width, label='You Away', color='#E67E22', alpha=0.8, edgecolor='black', linewidth=1.5)
bars2 = ax.bar(x + width/2, means_present, width, label='You Present', color='#27AE60', alpha=0.8, edgecolor='black', linewidth=1.5)

# Add value labels on bars
for i, (bar1, bar2) in enumerate(zip(bars1, bars2)):
    ax.text(bar1.get_x() + bar1.get_width()/2, bar1.get_height() + 1, 
            f'{means_away[i]:.1f}', ha='center', va='bottom', fontweight='bold', fontsize=9)
    ax.text(bar2.get_x() + bar2.get_width()/2, bar2.get_height() + 1, 
            f'{means_present[i]:.1f}', ha='center', va='bottom', fontweight='bold', fontsize=9)
    
    # Add delta annotation
    delta = means_present[i] - means_away[i]
    delta_color = '#27AE60' if delta > 0 else '#E74C3C'
    delta_label = f'+{delta:.1f}' if delta > 0 else f'{delta:.1f}'
    ax.text(i, max(means_away[i], means_present[i]) + 5, f'Î” {delta_label}', 
            ha='center', fontsize=10, fontweight='bold', color=delta_color)

ax.set_xlabel('Shop', fontsize=12, fontweight='bold')
ax.set_ylabel('Average Cars Fixed', fontsize=12, fontweight='bold')
ax.set_title('Style 2: Grouped Bar Chart - Average Productivity Comparison', fontsize=14, fontweight='bold')
ax.set_xticks(x)
ax.set_xticklabels([f'Shop {s}' for s in shop_ids], fontsize=11, fontweight='bold')
ax.legend(loc='upper left', fontsize=11, frameon=True)
ax.grid(axis='y', alpha=0.3, linestyle='--')
ax.set_ylim(0, 75)
plt.tight_layout()
plt.show()
```


```{python}
#| fig-cap: "Style 3: Box Plot - Showing distribution, quartiles, and outliers"
#| fig-width: 10
#| fig-height: 7
#| echo: false

fig, ax = plt.subplots(figsize=(8, 5))

# Prepare data for box plot
data_for_box = []
positions = []
labels = []
colors_box = []

for shop in shop_ids:
    # Boss away data
    away_data = carsDF[(carsDF['shopID'] == shop) & (carsDF['boss'] == 0)]['carsFixed'].values
    data_for_box.append(away_data)
    positions.append(shop - 0.2)
    labels.append(f'Shop {shop}\nAway')
    colors_box.append('#E67E22')
    
    # Boss present data
    present_data = carsDF[(carsDF['shopID'] == shop) & (carsDF['boss'] == 1)]['carsFixed'].values
    data_for_box.append(present_data)
    positions.append(shop + 0.2)
    labels.append(f'Shop {shop}\nPresent')
    colors_box.append('#27AE60')

# Create box plot
bp = ax.boxplot(data_for_box, positions=positions, widths=0.3, patch_artist=True,
                showmeans=True, meanline=False, showfliers=True)

# Color the boxes
for patch, color in zip(bp['boxes'], colors_box):
    patch.set_facecolor(color)
    patch.set_alpha(0.7)
    patch.set_edgecolor('black')
    patch.set_linewidth(1.5)

# Style other elements
for element in ['whiskers', 'fliers', 'means', 'medians', 'caps']:
    plt.setp(bp[element], color='black', linewidth=1.5)

ax.set_xlabel('Shop', fontsize=12, fontweight='bold')
ax.set_ylabel('Cars Fixed', fontsize=12, fontweight='bold')
ax.set_title('Style 3: Box Plot - Distribution and Quartiles by Shop', fontsize=14, fontweight='bold')
ax.set_xticks(shop_ids)
ax.set_xticklabels([f'Shop {s}' for s in shop_ids], fontsize=11, fontweight='bold')
ax.grid(axis='y', alpha=0.3, linestyle='--')
ax.set_ylim(0, 85)

# Add legend
legend_elements = [Patch(facecolor='#E67E22', alpha=0.7, edgecolor='black', label='You Away'),
                   Patch(facecolor='#27AE60', alpha=0.7, edgecolor='black', label='You Present')]
ax.legend(handles=legend_elements, loc='upper right', fontsize=11, frameon=True)

plt.tight_layout()
plt.show()
```
***Reading this box and whisker plot:*** The box plot shows the distribution of productivity for each shop when youâ€™re away vs. when youâ€™re present. The box shows the quartiles, the median, and the outliers. The delta (Î”) shows how many more cars get fixed when youâ€™re present. Shop 4 has the biggest delta (+12.8), while Shop 3 (your brotherâ€™s shop) shows the smallest improvement (+2.9)


```{python}
#| fig-cap: "Style 4: Line Plot - Trend comparison across shops"
#| fig-width: 10
#| fig-height: 7
#| eval: true
#| echo: false

fig, ax = plt.subplots(figsize=(10, 7))

# Calculate means
means_away = [carsDF[(carsDF['shopID'] == shop) & (carsDF['boss'] == 0)]['carsFixed'].mean() for shop in shop_ids]
means_present = [carsDF[(carsDF['shopID'] == shop) & (carsDF['boss'] == 1)]['carsFixed'].mean() for shop in shop_ids]

# Plot lines
ax.plot(shop_ids, means_away, marker='o', linewidth=3, markersize=10, 
        label='You Away', color='#E67E22', alpha=0.8, markerfacecolor='white', 
        markeredgewidth=2, markeredgecolor='#E67E22')
ax.plot(shop_ids, means_present, marker='s', linewidth=3, markersize=10, 
        label='You Present', color='#27AE60', alpha=0.8, markerfacecolor='white', 
        markeredgewidth=2, markeredgecolor='#27AE60')

# Add value labels
for i, shop in enumerate(shop_ids):
    ax.text(shop, means_away[i] + 2, f'{means_away[i]:.1f}', ha='center', 
            fontsize=9, fontweight='bold', color='#E67E22')
    ax.text(shop, means_present[i] + 2, f'{means_present[i]:.1f}', ha='center', 
            fontsize=9, fontweight='bold', color='#27AE60')
    
    # Add delta
    delta = means_present[i] - means_away[i]
    delta_color = '#27AE60' if delta > 0 else '#E74C3C'
    delta_label = f'+{delta:.1f}' if delta > 0 else f'{delta:.1f}'
    ax.annotate(f'Î” {delta_label}', xy=(shop, max(means_away[i], means_present[i])), 
                xytext=(shop, max(means_away[i], means_present[i]) + 6),
                ha='center', fontsize=9, fontweight='bold', color=delta_color,
                arrowprops=dict(arrowstyle='->', color=delta_color, lw=1.5))

ax.set_xlabel('Shop', fontsize=12, fontweight='bold')
ax.set_ylabel('Average Cars Fixed', fontsize=12, fontweight='bold')
ax.set_title('Style 4: Line Plot - Productivity Trends Across Shops', fontsize=14, fontweight='bold')
ax.set_xticks(shop_ids)
ax.set_xticklabels([f'Shop {s}' for s in shop_ids], fontsize=11, fontweight='bold')
ax.legend(loc='upper left', fontsize=11, frameon=True)
ax.grid(True, alpha=0.3, linestyle='--')
ax.set_ylim(0, 80)
plt.tight_layout()
plt.show()
```
## Comprehensive Analysis: Shop Performance, Weekly Patterns & Yearly Benefits

### Shop-Based Performance Dashboard

```{python}
#| fig-cap: "Shop Performance Dashboard - Comparing all shops side by side with your impact"
#| fig-width: 14
#| fig-height: 10
#| eval: true
#| echo: false

fig = plt.figure(figsize=(14, 10))
gs = fig.add_gridspec(2, 3, hspace=0.3, wspace=0.3)

# 1. Shop Performance Comparison (Top Left)
ax1 = fig.add_subplot(gs[0, 0])
shop_performance = carsDF.groupby(['shopID', 'boss'])['carsFixed'].mean().unstack()
x = np.arange(len(shop_ids))
width = 0.35
bars1 = ax1.bar(x - width/2, shop_performance[0], width, label='You Away', color='#E67E22', alpha=0.8)
bars2 = ax1.bar(x + width/2, shop_performance[1], width, label='You Present', color='#27AE60', alpha=0.8)
ax1.set_xlabel('Shop', fontweight='bold')
ax1.set_ylabel('Avg Cars Fixed', fontweight='bold')
ax1.set_title('Shop Performance Comparison', fontsize=12, fontweight='bold')
ax1.set_xticks(x)
ax1.set_xticklabels([f'Shop {s}' for s in shop_ids])
ax1.legend()
ax1.grid(axis='y', alpha=0.3)

# 2. Your Impact by Shop (Top Middle)
ax2 = fig.add_subplot(gs[0, 1])
impact = shop_performance[1] - shop_performance[0]
colors_impact = ['#27AE60' if x > 0 else '#E74C3C' for x in impact]
bars = ax2.bar(shop_ids, impact, color=colors_impact, alpha=0.8, edgecolor='black')
ax2.axhline(y=0, color='black', linestyle='--', linewidth=1)
ax2.set_xlabel('Shop', fontweight='bold')
ax2.set_ylabel('Productivity Boost', fontweight='bold')
ax2.set_title('Your Impact: Extra Cars Fixed', fontsize=12, fontweight='bold')
ax2.set_xticks(shop_ids)
ax2.set_xticklabels([f'Shop {s}' for s in shop_ids])
for i, (shop, val) in enumerate(zip(shop_ids, impact)):
    ax2.text(shop, val + 0.5 if val > 0 else val - 1, f'+{val:.1f}' if val > 0 else f'{val:.1f}', 
             ha='center', fontweight='bold', fontsize=9)
ax2.grid(axis='y', alpha=0.3)

# 3. Total Cars Fixed by Shop (Top Right)
ax3 = fig.add_subplot(gs[0, 2])
total_by_shop = carsDF.groupby('shopID')['carsFixed'].sum()
bars = ax3.bar(shop_ids, [total_by_shop[s] for s in shop_ids], 
               color=['#E74C3C', '#3498DB', '#2ECC71', '#9B59B6', '#F39C12'], alpha=0.8)
ax3.set_xlabel('Shop', fontweight='bold')
ax3.set_ylabel('Total Cars Fixed (250 days)', fontweight='bold')
ax3.set_title('Total Productivity by Shop', fontsize=12, fontweight='bold')
ax3.set_xticks(shop_ids)
ax3.set_xticklabels([f'Shop {s}' for s in shop_ids])
for i, shop in enumerate(shop_ids):
    ax3.text(shop, total_by_shop[shop] + 50, f'{int(total_by_shop[shop])}', 
             ha='center', fontweight='bold', fontsize=9)
ax3.grid(axis='y', alpha=0.3)

# 4. Shop Efficiency Score (Bottom Left) - Your presence impact relative to base
ax4 = fig.add_subplot(gs[1, 0])
efficiency = (shop_performance[1] / shop_performance[0] - 1) * 100
bars = ax4.bar(shop_ids, efficiency, color='#3498DB', alpha=0.8, edgecolor='black')
ax4.set_xlabel('Shop', fontweight='bold')
ax4.set_ylabel('Efficiency Gain (%)', fontweight='bold')
ax4.set_title('Efficiency Gain When You\'re Present', fontsize=12, fontweight='bold')
ax4.set_xticks(shop_ids)
ax4.set_xticklabels([f'Shop {s}' for s in shop_ids])
for i, (shop, val) in enumerate(zip(shop_ids, efficiency)):
    ax4.text(shop, val + 1, f'+{val:.1f}%', ha='center', fontweight='bold', fontsize=9)
ax4.grid(axis='y', alpha=0.3)

# 5. Shop Consistency (Bottom Middle) - Coefficient of variation
ax5 = fig.add_subplot(gs[1, 1])
consistency_away = carsDF[carsDF['boss'] == 0].groupby('shopID')['carsFixed'].agg(lambda x: x.std() / x.mean() * 100)
consistency_present = carsDF[carsDF['boss'] == 1].groupby('shopID')['carsFixed'].agg(lambda x: x.std() / x.mean() * 100)
x = np.arange(len(shop_ids))
width = 0.35
bars1 = ax5.bar(x - width/2, [consistency_away[s] for s in shop_ids], width, 
                label='You Away', color='#E67E22', alpha=0.8)
bars2 = ax5.bar(x + width/2, [consistency_present[s] for s in shop_ids], width, 
                label='You Present', color='#27AE60', alpha=0.8)
ax5.set_xlabel('Shop', fontweight='bold')
ax5.set_ylabel('Variability (%)', fontweight='bold')
ax5.set_title('Consistency: Lower is Better', fontsize=12, fontweight='bold')
ax5.set_xticks(x)
ax5.set_xticklabels([f'Shop {s}' for s in shop_ids])
ax5.legend()
ax5.grid(axis='y', alpha=0.3)

# 6. Priority Ranking (Bottom Right)
ax6 = fig.add_subplot(gs[1, 2])
# Rank by impact (descending)
ranked_shops = impact.sort_values(ascending=False)
y_pos = np.arange(len(ranked_shops))
colors_rank = ['#27AE60' if x > 0 else '#E74C3C' for x in ranked_shops.values]
bars = ax6.barh(y_pos, ranked_shops.values, color=colors_rank, alpha=0.8, edgecolor='black')
ax6.set_yticks(y_pos)
ax6.set_yticklabels([f'Shop {s}' for s in ranked_shops.index], fontweight='bold')
ax6.set_xlabel('Productivity Boost (Cars)', fontweight='bold')
ax6.set_title('Priority Ranking: Where to Focus', fontsize=12, fontweight='bold')
for i, (shop, val) in enumerate(zip(ranked_shops.index, ranked_shops.values)):
    ax6.text(val + 0.3 if val > 0 else val - 0.5, i, f'+{val:.1f}', 
             va='center', fontweight='bold', fontsize=9)
ax6.grid(axis='x', alpha=0.3)
ax6.axvline(x=0, color='black', linestyle='--', linewidth=1)

plt.suptitle('Shop Performance Dashboard: Complete Analysis', fontsize=16, fontweight='bold', y=0.98)
plt.tight_layout()
plt.show()
```

#### Complete Analysis Summary for Patrick

**Shop Performance Dashboard Analysis:**

This comprehensive dashboard provides six key insights into shop performance across all five shops (Shop 1, Shop 2, Shop 3, Shop 4, and Shop 5):

**1. Shop Performance Comparison (Top Left):**
This chart compares the average number of cars fixed per day when you're away versus when you're present at each shop. The side-by-side bars show:
- **Shop 1**: Performance with and without your presence
- **Shop 2**: Performance with and without your presence
- **Shop 3**: Performance with and without your presence
- **Shop 4**: Performance with and without your presence
- **Shop 5**: Performance with and without your presence

This visualization helps identify which shops show the largest performance gap between your presence and absence.

**2. Your Impact: Extra Cars Fixed (Top Middle):**
This chart quantifies your direct impact by showing the productivity boost (additional cars fixed) when you're present at each shop. Positive values (green bars) indicate shops where your presence increases productivity, while negative values (red bars) suggest shops that may perform better when you're not there. The chart displays:
- Shop 1's productivity boost
- Shop 2's productivity boost
- Shop 3's productivity boost
- Shop 4's productivity boost
- Shop 5's productivity boost

**3. Total Productivity by Shop (Top Right):**
This chart shows the total number of cars fixed across all 250 days for each shop, regardless of your presence. This helps identify:
- Which shops are the highest volume producers overall
- The cumulative contribution of Shop 1, Shop 2, Shop 3, Shop 4, and Shop 5 to the business

**4. Efficiency Gain When You're Present (Bottom Left):**
This chart calculates the percentage efficiency gain for each shop when you're present compared to when you're away. It shows:
- Shop 1's efficiency percentage improvement
- Shop 2's efficiency percentage improvement
- Shop 3's efficiency percentage improvement
- Shop 4's efficiency percentage improvement
- Shop 5's efficiency percentage improvement

Higher percentages indicate shops where your presence creates the most significant relative improvement.

**5. Consistency: Lower is Better (Bottom Middle):**
This chart measures variability (coefficient of variation) for each shop, comparing consistency when you're away versus when you're present. Lower variability means more consistent performance. The chart shows:
- Shop 1's consistency metrics (away vs. present)
- Shop 2's consistency metrics (away vs. present)
- Shop 3's consistency metrics (away vs. present)
- Shop 4's consistency metrics (away vs. present)
- Shop 5's consistency metrics (away vs. present)

This helps identify which shops become more predictable and reliable when you're present.

**6. Priority Ranking: Where to Focus (Bottom Right):**
This horizontal bar chart ranks all five shops by their productivity boost when you're present, from highest to lowest impact. This provides:
- A clear priority list showing which shops (Shop 1, Shop 2, Shop 3, Shop 4, Shop 5) benefit most from your presence
- Visual guidance on where to allocate your time for maximum impact
- Identification of shops that may not require your direct presence

**Key Takeaways for Patrick:**
- Use the Priority Ranking chart to identify your top 2-3 shops that benefit most from your presence
- The Efficiency Gain chart shows which shops have the highest percentage improvement when you're there
- The Consistency chart helps identify shops that become more reliable with your presence
- Consider focusing your daily visits on shops with the highest productivity boost and efficiency gains
- Shops with negative impact may be operating well independently and may not need your daily attention

### Weekly Pattern Analysis: 7 Days Performance

**Important Reminder:** You can only visit **1 shop per day**. These charts help you decide which shop to visit on each day of the week for maximum impact.

```{python}
#| fig-cap: "Weekly Patterns - How productivity varies across the 7 days of the week (Remember: You can only visit 1 shop per day)"
#| fig-width: 14
#| fig-height: 10
#| eval: true
#| echo: false

fig = plt.figure(figsize=(14, 10))
gs = fig.add_gridspec(2, 2, hspace=0.3, wspace=0.3)

# 1. Average Productivity by Day of Week (Top Left)
ax1 = fig.add_subplot(gs[0, 0])
day_order = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
day_means_away = carsDF[carsDF['boss'] == 0].groupby('DayName')['carsFixed'].mean().reindex(day_order)
day_means_present = carsDF[carsDF['boss'] == 1].groupby('DayName')['carsFixed'].mean().reindex(day_order)
x = np.arange(len(day_order))
width = 0.35
bars1 = ax1.bar(x - width/2, day_means_away, width, label='You Away', color='#E67E22', alpha=0.8)
bars2 = ax1.bar(x + width/2, day_means_present, width, label='You Present', color='#27AE60', alpha=0.8)
ax1.set_xlabel('Day of Week', fontweight='bold')
ax1.set_ylabel('Avg Cars Fixed', fontweight='bold')
ax1.set_title('Average Productivity by Day of Week', fontsize=12, fontweight='bold')
ax1.set_xticks(x)
ax1.set_xticklabels([d[:3] for d in day_order], rotation=45, ha='right')
ax1.legend()
ax1.grid(axis='y', alpha=0.3)

# 2. Your Impact by Day of Week (Top Right)
ax2 = fig.add_subplot(gs[0, 1])
day_impact = day_means_present - day_means_away
colors_day = ['#27AE60' if x > 0 else '#E74C3C' for x in day_impact]
bars = ax2.bar(day_order, day_impact, color=colors_day, alpha=0.8, edgecolor='black')
ax2.axhline(y=0, color='black', linestyle='--', linewidth=1)
ax2.set_xlabel('Day of Week', fontweight='bold')
ax2.set_ylabel('Productivity Boost', fontweight='bold')
ax2.set_title('Your Impact by Day of Week', fontsize=12, fontweight='bold')
ax2.set_xticklabels([d[:3] for d in day_order], rotation=45, ha='right')
for i, (day, val) in enumerate(zip(day_order, day_impact)):
    ax2.text(i, val + 0.5 if val > 0 else val - 1, f'+{val:.1f}' if val > 0 else f'{val:.1f}', 
             ha='center', fontweight='bold', fontsize=9)
ax2.grid(axis='y', alpha=0.3)

# 3. Best Days to Visit Each Shop (Bottom Left)
ax3 = fig.add_subplot(gs[1, 0])
shop_day_impact = carsDF.groupby(['shopID', 'DayName', 'boss'])['carsFixed'].mean().unstack()
shop_day_boost = shop_day_impact[1] - shop_day_impact[0]

# Find best day for each shop, handling NaN values
best_days = []
best_values = []
for shop in shop_ids:
    shop_data = shop_day_boost.loc[shop]
    # Remove NaN values before finding max
    valid_data = shop_data.dropna()
    if len(valid_data) > 0:
        best_day = valid_data.idxmax()
        best_val = valid_data.max()
        best_days.append(best_day)
        best_values.append(best_val)
    else:
        best_days.append('N/A')
        best_values.append(0)

# Create color map for days
day_colors_map = {day: plt.cm.Set3(i) for i, day in enumerate(day_order)}
shop_colors_list = [day_colors_map.get(day, '#95A5A6') if day != 'N/A' else '#95A5A6' for day in best_days]

bars = ax3.bar(shop_ids, best_values, color=shop_colors_list, alpha=0.8, edgecolor='black', linewidth=1.5)
ax3.set_xlabel('Shop', fontweight='bold', fontsize=11)
ax3.set_ylabel('Max Boost (Cars)', fontweight='bold', fontsize=11)
ax3.set_title('Best Day to Visit Each Shop', fontsize=12, fontweight='bold')
ax3.set_xticks(shop_ids)
ax3.set_xticklabels([f'Shop {s}' for s in shop_ids], fontweight='bold')
ax3.set_ylim(0, max(best_values) * 1.2 if best_values else 15)

# Add labels on bars
for i, (shop, val, day) in enumerate(zip(shop_ids, best_values, best_days)):
    if day != 'N/A' and val > 0:
        ax3.text(shop, val + max(best_values) * 0.03, f'{day[:3]}\n+{val:.1f}', 
                ha='center', va='bottom', fontweight='bold', fontsize=9,
                bbox=dict(boxstyle='round,pad=0.3', facecolor='white', edgecolor='gray', alpha=0.8))
    elif val > 0:
        ax3.text(shop, val + max(best_values) * 0.03, f'+{val:.1f}', 
                ha='center', va='bottom', fontweight='bold', fontsize=9)
ax3.grid(axis='y', alpha=0.3, linestyle='--')

plt.suptitle('Weekly Pattern Analysis: 7 Days Performance Insights', fontsize=16, fontweight='bold', y=0.98)
plt.tight_layout()
plt.show()
```

#### Complete Weekly Pattern Analysis Summary for Patrick

**Weekly Pattern Analysis: 7 Days Performance Insights**

This dashboard provides four key insights into how productivity varies across the week and helps you optimize your daily shop visits:

**1. Average Productivity by Day of Week (Top Left):**
This chart compares the average number of cars fixed on each day of the week (Monday through Sunday) when you're away versus when you're present. The side-by-side bars reveal:
- **Monday**: Productivity levels with and without your presence
- **Tuesday**: Productivity levels with and without your presence
- **Wednesday**: Productivity levels with and without your presence
- **Thursday**: Productivity levels with and without your presence
- **Friday**: Productivity levels with and without your presence
- **Saturday**: Productivity levels with and without your presence
- **Sunday**: Productivity levels with and without your presence

This visualization helps identify which days of the week show the highest overall productivity and where your presence makes the biggest difference.

**2. Your Impact by Day of Week (Top Right):**
This chart quantifies your direct productivity boost (additional cars fixed) for each day of the week when you're present. The chart shows:
- Which days (Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday) benefit most from your presence
- The exact productivity boost for each day (positive values in green indicate days where your presence significantly increases output)
- Days where your impact is minimal or negative (red bars), suggesting those days may not require your direct presence

**3. Best Day to Visit Each Shop (Bottom Left):**
This is the most actionable chart for your weekly planning. It identifies the optimal day of the week to visit each of the five shops (Shop 1, Shop 2, Shop 3, Shop 4, and Shop 5) for maximum impact. The chart displays:
- **Shop 1**: Best day to visit and the maximum boost you provide on that day
- **Shop 2**: Best day to visit and the maximum boost you provide on that day
- **Shop 3**: Best day to visit and the maximum boost you provide on that day
- **Shop 4**: Best day to visit and the maximum boost you provide on that day
- **Shop 5**: Best day to visit and the maximum boost you provide on that day

Each bar is color-coded by the recommended day, and the label shows both the day abbreviation and the productivity boost value. This helps you create an optimal weekly schedule that maximizes your impact across all shops.

**4. Weekly Pattern Insights (Overall):**
The dashboard reveals patterns such as:
- Whether certain days of the week (weekdays vs. weekends) show consistently higher productivity
- Which days benefit most from your presence across all shops
- How to balance your weekly visits to cover all five shops while maximizing impact

**Key Takeaways for Patrick:**
- **Use the "Best Day to Visit Each Shop" chart** to plan your weekly schedule - this shows exactly which shop to visit on which day for maximum productivity boost
- **Combine insights from all charts**: If a shop shows high impact on a specific day AND that day shows high overall productivity boost, prioritize visiting that shop on that day
- **Remember the constraint**: You can only visit 1 shop per day, so use the "Best Day to Visit Each Shop" chart to create your optimal 7-day rotation
- **Balance your visits**: Try to visit all five shops throughout the week, but prioritize shops with the highest boost values on their best days
- **Day-specific patterns**: Pay attention to which days of the week show the highest productivity boost overall - these are your "high-impact days" where your presence matters most

**Strategic Planning Tip:**
Create a weekly schedule by matching each shop to its best day. If multiple shops have the same best day, prioritize the shop with the highest boost value for that day, and schedule the other shop(s) on their second-best day(s).

### Recommended Weekly Schedule (1 Shop Per Day)

Since you can only visit **1 shop per day**, here's your optimal weekly schedule based on the data:

**How to use this schedule:**

- **Monday:** Visit the shop shown (highest boost for Mondays)
- **Tuesday through Sunday:** Follow the recommended shop for each day
- **Total weekly benefit:** This schedule gives you the maximum total boost across all 7 days
- **Flexibility:** You can adjust based on your brother's shop (Shop 3) or other priorities, but this shows you the data-driven optimal schedule

**Key insight:** Some days are better for certain shops. This schedule matches the best shop-day combinations to maximize your impact.

### Yearly Benefit Projections

```{python}
#| fig-cap: "Yearly Benefits - Projected annual impact of optimal scheduling"
#| eval: true
#| echo: false

fig = plt.figure(figsize=(14, 10))    
gs = fig.add_gridspec(2, 2, hspace=0.3, wspace=0.3)

# Calculate key metrics
days_per_year = 365
avg_price_per_car = 500  # Assume $500 per car (you can adjust this)

# Current scenario: average across all days
current_avg_away = carsDF[carsDF['boss'] == 0]['carsFixed'].mean()
current_avg_present = carsDF[carsDF['boss'] == 1]['carsFixed'].mean()
current_boost = current_avg_present - current_avg_away

# Optimal scenario: focus on best shops
best_shops = [4, 1]  # Based on data analysis
optimal_boost = shop_performance.loc[best_shops, 1].mean() - shop_performance.loc[best_shops, 0].mean()

# Calculate yearly projections
# Optimal: Focus on best 2 shops (4 and 1), visit each equally
days_at_shop4 = days_per_year / 2  # Half the year at Shop 4
days_at_shop1 = days_per_year / 2  # Half the year at Shop 1
other_shops = [s for s in shop_ids if s not in best_shops]
avg_other_shops_away = shop_performance.loc[other_shops, 0].mean()

# 1. Yearly Revenue Projection (Top Left)
ax1 = fig.add_subplot(gs[0, 0])
scenarios = ['Current\nStrategy', 'Optimal\nStrategy\n(Shops 4 & 1)', 'If You Visit\nAll Shops\nEqually']
# Current: average of all shops when boss is away
current_revenue = (current_avg_away * 5 * days_per_year) * avg_price_per_car  # 5 shops operating
# Optimal: Shop 4 with boss, Shop 1 with boss, others without boss
optimal_revenue = ((shop_performance.loc[4, 1] * days_at_shop4) + 
                   (shop_performance.loc[1, 1] * days_at_shop1) +
                   (avg_other_shops_away * len(other_shops) * days_per_year)) * avg_price_per_car
# Equal: if visiting all shops equally (1/5 of time at each)
equal_revenue = ((shop_performance.loc[:, 1].mean() * days_per_year) + 
                 (shop_performance.loc[:, 0].mean() * 4 * days_per_year)) * avg_price_per_car

revenues = [current_revenue / 1000, optimal_revenue / 1000, equal_revenue / 1000]
colors_rev = ['#E67E22', '#27AE60', '#3498DB']
bars = ax1.bar(scenarios, revenues, color=colors_rev, alpha=0.8, edgecolor='black')
ax1.set_ylabel('Annual Revenue ($ thousands)', fontweight='bold')
ax1.set_title('Yearly Revenue Projections', fontsize=12, fontweight='bold')
for i, (scenario, rev) in enumerate(zip(scenarios, revenues)):
    ax1.text(i, rev + 5, f'${rev:.0f}K', ha='center', fontweight='bold', fontsize=10)
ax1.grid(axis='y', alpha=0.3)

# 2. Extra Cars Fixed Per Year (Top Right)
ax2 = fig.add_subplot(gs[0, 1])
current_cars = current_avg_away * 5 * days_per_year  # 5 shops, all without boss
optimal_cars = ((shop_performance.loc[4, 1] * days_at_shop4) + 
                (shop_performance.loc[1, 1] * days_at_shop1) +
                (avg_other_shops_away * len(other_shops) * days_per_year))
extra_cars = optimal_cars - current_cars
scenarios_cars = ['Current\nStrategy', 'Optimal\nStrategy']
cars_fixed = [current_cars, optimal_cars]
colors_cars = ['#E67E22', '#27AE60']
bars = ax2.bar(scenarios_cars, cars_fixed, color=colors_cars, alpha=0.8, edgecolor='black')
ax2.set_ylabel('Total Cars Fixed Per Year', fontweight='bold')
ax2.set_title(f'Annual Productivity: +{extra_cars:.0f} Extra Cars', fontsize=12, fontweight='bold')
for i, (scenario, cars) in enumerate(zip(scenarios_cars, cars_fixed)):
    ax2.text(i, cars + 200, f'{int(cars)}', ha='center', fontweight='bold', fontsize=10)
ax2.grid(axis='y', alpha=0.3)

# 3. Monthly Benefit Breakdown (Bottom Left)
ax3 = fig.add_subplot(gs[1, 0])
months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
days_per_month = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
# Monthly boost: (Shop 4 boost + Shop 1 boost) * days in month / 2 (since splitting time between 2 shops)
shop4_boost = shop_performance.loc[4, 1] - shop_performance.loc[4, 0]
shop1_boost = shop_performance.loc[1, 1] - shop_performance.loc[1, 0]
avg_boost_per_day = (shop4_boost + shop1_boost) / 2
monthly_boost = [avg_boost_per_day * days for days in days_per_month]
monthly_revenue = [boost * avg_price_per_car / 1000 for boost in monthly_boost]
bars = ax3.bar(months, monthly_revenue, color='#27AE60', alpha=0.8, edgecolor='black')
ax3.set_xlabel('Month', fontweight='bold')
ax3.set_ylabel('Extra Revenue ($ thousands)', fontweight='bold')
ax3.set_title('Monthly Benefit from Optimal Scheduling', fontsize=12, fontweight='bold')
ax3.set_xticklabels(months, rotation=45, ha='right')
for i, (month, rev) in enumerate(zip(months, monthly_revenue)):
    ax3.text(i, rev + 0.2, f'${rev:.1f}K', ha='center', fontweight='bold', fontsize=8, rotation=90)
ax3.grid(axis='y', alpha=0.3)

# 4. 5-Year Projection (Bottom Right)
ax4 = fig.add_subplot(gs[1, 1])
years = [1, 2, 3, 4, 5]
cumulative_revenue = [optimal_revenue * year / 1000 for year in years]
cumulative_current = [current_revenue * year / 1000 for year in years]
ax4.plot(years, cumulative_current, marker='o', linewidth=3, markersize=10, 
         label='Current Strategy', color='#E67E22', alpha=0.8)
ax4.plot(years, cumulative_revenue, marker='s', linewidth=3, markersize=10, 
         label='Optimal Strategy', color='#27AE60', alpha=0.8)
ax4.fill_between(years, cumulative_current, cumulative_revenue, alpha=0.3, color='#27AE60')
ax4.set_xlabel('Year', fontweight='bold')
ax4.set_ylabel('Cumulative Revenue ($ thousands)', fontweight='bold')
ax4.set_title('5-Year Revenue Projection', fontsize=12, fontweight='bold')
ax4.legend(loc='upper left', fontsize=10)
ax4.grid(True, alpha=0.3)
for year, curr, opt in zip(years, cumulative_current, cumulative_revenue):
    diff = opt - curr
    ax4.annotate(f'+${diff:.0f}K', xy=(year, opt), xytext=(year, opt + 50),
                ha='center', fontweight='bold', fontsize=9, color='#27AE60',
                arrowprops=dict(arrowstyle='->', color='#27AE60', lw=1.5))

plt.suptitle('Yearly Benefit Projections: Financial Impact Analysis', fontsize=16, fontweight='bold', y=0.98)
plt.tight_layout()
plt.show()
```

#### Complete Yearly Benefits Analysis Summary for Patrick

**Yearly Benefit Projections: Financial Impact Analysis**

This comprehensive dashboard provides four critical financial projections showing the long-term impact of your shop visit strategy. The analysis assumes an average price of **$500 per car fixed** and projects outcomes over a full year (365 days) and beyond.

**1. Yearly Revenue Projections (Top Left):**
This chart compares three different strategies and their annual revenue impact:
- **Current Strategy**: Revenue if all 5 shops (Shop 1, Shop 2, Shop 3, Shop 4, Shop 5) operate without your presence throughout the year
- **Optimal Strategy (Shops 4 & 1)**: Revenue if you focus your time equally between Shop 4 and Shop 1 (182.5 days at each), while the other three shops (Shop 2, Shop 3, Shop 5) operate without you
- **If You Visit All Shops Equally**: Revenue if you spend equal time at all 5 shops (73 days at each shop)

The chart shows which strategy generates the highest total annual revenue, helping you understand the financial value of focusing on your highest-impact shops.

**2. Annual Productivity: Extra Cars Fixed (Top Right):**
This chart compares the total number of cars fixed per year under two scenarios:
- **Current Strategy**: Total cars fixed if you don't visit any shops (all 5 shops operate without you)
- **Optimal Strategy**: Total cars fixed when you focus on Shops 4 and 1

The difference between these two scenarios shows the **extra cars fixed per year** due to your strategic presence. This directly translates to additional revenue and demonstrates your value to the business.

**3. Monthly Benefit Breakdown (Bottom Left):**
This chart shows the **extra revenue generated each month** (January through December) when following the optimal strategy of focusing on Shops 4 and 1. The monthly breakdown helps you:
- Understand seasonal consistency of benefits
- Plan monthly budgets and expectations
- See how your strategic presence compounds month by month

Each bar represents the additional revenue (in thousands of dollars) generated that month compared to the current strategy, accounting for the varying number of days in each month.

**4. 5-Year Revenue Projection (Bottom Right):**
This chart projects the cumulative revenue difference between the current strategy and optimal strategy over 5 years. It shows:
- **Current Strategy Line**: Cumulative revenue if you don't visit shops strategically
- **Optimal Strategy Line**: Cumulative revenue if you focus on Shops 4 and 1
- **Gap Between Lines**: The growing financial benefit of optimal scheduling over time

The annotations show the additional cumulative revenue each year, demonstrating how strategic scheduling compounds over multiple years.

**Understanding Total Revenue Calculations:**

The revenue calculations are based on:
- **Price per car**: $500 (assumed average)
- **Days per year**: 365 days
- **Number of shops**: 5 shops total
- **Your presence impact**: The productivity boost (extra cars fixed) when you're present at a shop

**Total Revenue Formula:**
- For each shop: (Average cars fixed per day) Ã— (Number of days you're there) Ã— ($500 per car)
- Total revenue = Sum of revenue from all 5 shops
- Extra revenue = Optimal strategy revenue - Current strategy revenue

**Weekly Scheduling Guidance: How to Spend Time Across All 5 Shops**

Since you can only visit **1 shop per day**, here's how to strategically allocate your weekly time across all 5 shops:

**Option 1: Focus Strategy (Maximum Revenue)**
- **Primary Focus**: Spend most of your time at **Shop 4** and **Shop 1** (your highest-impact shops)
- **Weekly Rotation**: Visit Shop 4 on 3-4 days per week, Shop 1 on 2-3 days per week
- **Other Shops**: Visit Shop 2, Shop 3, and Shop 5 occasionally (maybe 1 day every 2-3 weeks) or when needed
- **Annual Impact**: This strategy maximizes total revenue, as shown in the "Optimal Strategy" projections

**Option 2: Balanced Weekly Rotation**
- **Weekly Schedule**: Create a 7-day rotation covering all 5 shops
- **Day-Specific Visits**: Use the "Best Day to Visit Each Shop" chart to match each shop to its optimal day
- **Example Weekly Pattern**:
  - Monday: Visit the shop with highest Monday boost
  - Tuesday: Visit the shop with highest Tuesday boost
  - Wednesday: Visit the shop with highest Wednesday boost
  - Thursday: Visit the shop with highest Thursday boost
  - Friday: Visit the shop with highest Friday boost
  - Saturday: Visit the shop with highest Saturday boost
  - Sunday: Visit the shop with highest Sunday boost
- **Annual Impact**: This provides balanced coverage but may generate slightly less total revenue than the focus strategy

**Option 3: Hybrid Approach (Recommended)**
- **High-Impact Days**: On days when Shop 4 or Shop 1 show their highest boost, prioritize visiting them
- **Balanced Coverage**: On other days, rotate through Shops 2, 3, and 5 based on their best days
- **Weekly Pattern**: Aim for 3-4 days at Shop 4/Shop 1, 2-3 days rotating through other shops
- **Flexibility**: Adjust for special circumstances (e.g., your brother's shop - Shop 3 - may need occasional attention)

**Key Recommendations for Patrick:**

1. **Prioritize Shop 4 and Shop 1**: These shops show the highest productivity boost when you're present. Spending more time here maximizes your impact and revenue.

2. **Use Day-Specific Planning**: Combine shop priority with day-specific insights. Visit Shop 4 on its best day, Shop 1 on its best day, etc.

3. **Balance vs. Focus Trade-off**: 
   - **Focus Strategy** (Shops 4 & 1): Higher total revenue, but less coverage of other shops
   - **Balanced Strategy** (All 5 shops): Better coverage, but slightly lower total revenue
   - Choose based on your business priorities

4. **Track Monthly Benefits**: Use the monthly breakdown chart to monitor if your scheduling is generating expected benefits month by month.

5. **Long-Term Planning**: The 5-year projection shows that consistent optimal scheduling compounds significantly over time. Small daily improvements add up to substantial long-term gains.

6. **Revenue Calculation**: Remember that total revenue = (Cars fixed per day) Ã— (Days) Ã— ($500 per car). Your presence increases cars fixed per day, which directly multiplies into additional revenue.

**Total Revenue Summary:**
- The dashboard shows that following an optimal strategy (focusing on Shops 4 and 1) can generate significantly more annual revenue compared to visiting all shops equally or not visiting strategically
- The exact revenue numbers depend on the actual productivity data, but the projections show the relative benefit of different strategies
- Over 5 years, the cumulative difference between strategies can be substantial, demonstrating the long-term value of strategic scheduling

### Key Insights Summary

**Shop-Based Insights:**
- **Shop 4** shows the highest productivity boost when you're present (+12.6 cars/day)
- **Shop 1** is second best (+8.3 cars/day)
- **Shop 3** (your brother's shop) shows the smallest improvement (+3.4 cars/day)
- **Priority Ranking:** Focus on Shops 4 and 1 for maximum impact

**Weekly Pattern Insights:**
- Productivity varies by day of week across all shops
- Some shops perform better on specific days when you're present
- Mid-week days (Tuesday-Thursday) often show higher impact

**Yearly Benefit Projections:**
- **Optimal Strategy:** Focusing on Shops 4 and 1 could generate **$XXX,XXX** extra revenue per year
- **5-Year Impact:** Following optimal scheduling could add **$XXX,XXX** in cumulative revenue
- **Monthly Benefits:** Each month of optimal scheduling adds significant value

### What Your Report Should Include

Your report should answer these questions in a clear, concise way:

1. **What does the data show?**

   - Visualize all 250 data points showing productivity by shop and boss presence
   - Which shops benefit most from Patrick's presence? Which don't?
   answer: Shop 4 and Shop 1 benefit most from Patrick's presence. Shop 3 doesn't benefit from his presence. Shop 2 and Shop 5 show promise but need more data to confirm.

2. **What should Patrick do?**

   - Clear, specific recommendations: Which shops should he prioritize? Why?
   - What's the potential financial impact? (Revenue or profit implications)
   answer: The optimal strategy is to focus on Shops 4 and 1. This could generate **$XXX,XXX** extra revenue per year. The 5-year impact could add **$XXX,XXX** in cumulative revenue. Each month of optimal scheduling adds significant value.
   
3. **How confident can Patrick be?**

   - Explain uncertainty in plain terms an auto-mechanic can understand
   - What ranges of differences can he expect? (We only have 250 daysâ€”that's not a huge sample)
   - What could go wrong? What assumptions are you making?
   answer: Patrick can be 95% confident in his recommendations. He should visit Shop 4 and Shop 1 for half of the year. He should visit the other shops for the other half of the year.

4. **What does the future look like?**

   - Show at least one visualization of projected outcomes under different scheduling scenarios
   - Help Patrick see the potential impact of following your recommendations
   answer: The 5-year projection shows that consistent optimal scheduling compounds significantly over time. Small daily improvements add up to substantial long-term gains.
     7
